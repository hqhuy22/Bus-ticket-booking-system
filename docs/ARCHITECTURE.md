# ðŸ—ï¸ System Architecture - Bus Ticket Booking System

Complete system architecture and design documentation.

## Table of Contents

- [System Overview](#system-overview)
- [Architecture Pattern](#architecture-pattern)
- [Technology Stack](#technology-stack)
- [System Components](#system-components)
- [Data Flow](#data-flow)
- [Security Architecture](#security-architecture)
- [Scalability Design](#scalability-design)
- [Deployment Architecture](#deployment-architecture)
- [Performance Optimization](#performance-optimization)
- [Monitoring and Logging](#monitoring-and-logging)

## System Overview

The Bus Ticket Booking System is a full-stack web application built using modern technologies and design patterns. It follows a client-server architecture with clear separation of concerns.

### High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CLIENT LAYER                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  React Frontend (Vite)                                â”‚   â”‚
â”‚  â”‚  - Redux Toolkit (State Management)                   â”‚   â”‚
â”‚  â”‚  - React Router (Navigation)                          â”‚   â”‚
â”‚  â”‚  - Tailwind CSS (Styling)                             â”‚   â”‚
â”‚  â”‚  - Axios (HTTP Client)                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ HTTPS/HTTP
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API GATEWAY                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Express.js Server                                    â”‚   â”‚
â”‚  â”‚  - CORS Middleware                                    â”‚   â”‚
â”‚  â”‚  - Authentication Middleware                          â”‚   â”‚
â”‚  â”‚  - Rate Limiting (optional)                           â”‚   â”‚
â”‚  â”‚  - Request Validation                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â–¼           â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BUSINESS LOGIC  â”‚ â”‚   SERVICES  â”‚ â”‚  MICROSERVICES   â”‚
â”‚                  â”‚ â”‚             â”‚ â”‚                  â”‚
â”‚  Controllers     â”‚ â”‚  Email      â”‚ â”‚  Payment Service â”‚
â”‚  - Customer      â”‚ â”‚  Service    â”‚ â”‚  Notification    â”‚
â”‚  - Booking       â”‚ â”‚             â”‚ â”‚  Service         â”‚
â”‚  - Schedule      â”‚ â”‚  PDF        â”‚ â”‚  Analytics       â”‚
â”‚  - Payment       â”‚ â”‚  Generator  â”‚ â”‚  Service         â”‚
â”‚  - Analytics     â”‚ â”‚             â”‚ â”‚                  â”‚
â”‚  - Chatbot       â”‚ â”‚  AI Chatbot â”‚ â”‚  Cache Service   â”‚
â”‚                  â”‚ â”‚  Service    â”‚ â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                   â”‚                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATA LAYER                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   PostgreSQL   â”‚  â”‚    Redis     â”‚  â”‚  File Storage  â”‚  â”‚
â”‚  â”‚   (Primary DB) â”‚  â”‚  (Cache +    â”‚  â”‚  (Uploads)     â”‚  â”‚
â”‚  â”‚                â”‚  â”‚   Sessions)  â”‚  â”‚                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   EXTERNAL SERVICES                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  PayOS     â”‚  â”‚  Google   â”‚  â”‚  Email Service       â”‚   â”‚
â”‚  â”‚  Payment   â”‚  â”‚  OAuth    â”‚  â”‚  (SendGrid/Gmail)    â”‚   â”‚
â”‚  â”‚  Gateway   â”‚  â”‚           â”‚  â”‚                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
â”‚  â”‚  Google    â”‚                                             â”‚
â”‚  â”‚  Gemini AI â”‚                                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Architecture Pattern

### 1. **MVC Pattern (Model-View-Controller)**

**Backend Structure:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Routes    â”‚  â†’ Defines API endpoints
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Controllers â”‚  â†’ Business logic & request handling
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Models    â”‚  â†’ Database schema & ORM
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database   â”‚  â†’ PostgreSQL
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Frontend Structure (Flux/Redux):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    View     â”‚  â†’ React Components
â”‚  (React)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Actions   â”‚  â†’ Redux Actions
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Reducers   â”‚  â†’ State Management
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Store    â”‚  â†’ Redux Store
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. **Service-Oriented Architecture (SOA)**

The system is designed with modular services:
- **Authentication Service** - User auth & session management
- **Booking Service** - Seat locking, booking creation
- **Payment Service** - Payment processing
- **Notification Service** - Email/SMS notifications
- **Analytics Service** - Data aggregation & reporting
- **Chatbot Service** - AI-powered assistance

### 3. **Microservices (Modular Design)**

Located in `bus-booking-server/microservices/`:
- Each service is self-contained
- Can be deployed independently
- Communicates via APIs
- Ready for containerization

## Technology Stack

### Frontend Technologies

| Technology | Purpose | Version |
|------------|---------|---------|
| **React** | UI Library | 18.3.1 |
| **Redux Toolkit** | State Management | 2.5.0 |
| **React Router** | Client-side Routing | 7.1.1 |
| **Tailwind CSS** | Styling Framework | 3.4.17 |
| **Vite** | Build Tool | 6.0.5 |
| **Axios** | HTTP Client | 1.7.9 |
| **Framer Motion** | Animations | 11.17.0 |
| **Recharts** | Data Visualization | 3.6.0 |

### Backend Technologies

| Technology | Purpose | Version |
|------------|---------|---------|
| **Node.js** | Runtime | 16+ |
| **Express.js** | Web Framework | 4.21.2 |
| **PostgreSQL** | Database | 12+ |
| **Sequelize** | ORM | 6.34.0 |
| **Redis** | Caching & Sessions | 5.3.2 |
| **JWT** | Authentication | 9.0.2 |
| **Passport.js** | OAuth | 0.7.0 |
| **PDFKit** | PDF Generation | 0.17.2 |
| **Nodemailer** | Email Service | 6.9.16 |

### External Services

| Service | Purpose |
|---------|---------|
| **Google Gemini AI** | Chatbot & NLP |
| **PayOS** | Payment Gateway |
| **Google OAuth** | Social Login |
| **SendGrid** | Email Delivery |

## System Components

### 1. Frontend Architecture

```
bus-booking-client/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/        # Reusable UI components
â”‚   â”‚   â”œâ”€â”€ common/       # Generic components
â”‚   â”‚   â”œâ”€â”€ admin/        # Admin-specific components
â”‚   â”‚   â””â”€â”€ booking/      # Booking-related components
â”‚   â”‚
â”‚   â”œâ”€â”€ pages/            # Page components (routes)
â”‚   â”‚   â”œâ”€â”€ Home.jsx
â”‚   â”‚   â”œâ”€â”€ SearchBuses.jsx
â”‚   â”‚   â”œâ”€â”€ SeatSelection.jsx
â”‚   â”‚   â”œâ”€â”€ BookingPayment.jsx
â”‚   â”‚   â””â”€â”€ AdminDashboard.jsx
â”‚   â”‚
â”‚   â”œâ”€â”€ redux/            # State management
â”‚   â”‚   â”œâ”€â”€ store.js      # Redux store configuration
â”‚   â”‚   â””â”€â”€ slices/       # Feature slices
â”‚   â”‚       â”œâ”€â”€ authSlice.js
â”‚   â”‚       â”œâ”€â”€ bookingSlice.js
â”‚   â”‚       â””â”€â”€ scheduleSlice.js
â”‚   â”‚
â”‚   â”œâ”€â”€ layouts/          # Layout components
â”‚   â”‚   â””â”€â”€ Layout.jsx    # Main layout wrapper
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/            # Custom React hooks
â”‚   â”‚   â””â”€â”€ useAuth.js
â”‚   â”‚
â”‚   â”œâ”€â”€ config/           # Configuration
â”‚   â”‚   â””â”€â”€ api.js        # API endpoints
â”‚   â”‚
â”‚   â””â”€â”€ utils/            # Utility functions
â”‚       â””â”€â”€ helpers.js
```

**Key Frontend Patterns:**

1. **Component Composition**
   - Small, reusable components
   - Props-based communication
   - Container/Presentational pattern

2. **State Management**
   - Redux Toolkit for global state
   - Local state for component-specific data
   - Async operations with Redux Thunk

3. **Routing**
   - Protected routes for authenticated users
   - Admin routes for admin-only pages
   - Dynamic route parameters

### 2. Backend Architecture

```
bus-booking-server/
â”œâ”€â”€ config/               # Configuration files
â”‚   â”œâ”€â”€ postgres.js      # Database connection
â”‚   â”œâ”€â”€ passport.js      # OAuth configuration
â”‚   â””â”€â”€ pricing.js       # Pricing calculations
â”‚
â”œâ”€â”€ models/              # Sequelize models
â”‚   â”œâ”€â”€ Customer.js
â”‚   â”œâ”€â”€ BusBooking.js
â”‚   â”œâ”€â”€ BusSchedule.js
â”‚   â””â”€â”€ associations.js  # Model relationships
â”‚
â”œâ”€â”€ controllers/         # Request handlers
â”‚   â”œâ”€â”€ customerController.js
â”‚   â”œâ”€â”€ busBookingController.js
â”‚   â”œâ”€â”€ busScheduleController.js
â”‚   â”œâ”€â”€ paymentController.js
â”‚   â””â”€â”€ chatbotController.js
â”‚
â”œâ”€â”€ routes/             # API routes
â”‚   â”œâ”€â”€ customerRoutes.js
â”‚   â”œâ”€â”€ busBookingRoutes.js
â”‚   â”œâ”€â”€ busScheduleRoutes.js
â”‚   â””â”€â”€ paymentRoutes.js
â”‚
â”œâ”€â”€ middleware/         # Custom middleware
â”‚   â”œâ”€â”€ authMiddleware.js
â”‚   â”œâ”€â”€ adminMiddleware.js
â”‚   â””â”€â”€ validation.js
â”‚
â”œâ”€â”€ services/           # Business logic services
â”‚   â”œâ”€â”€ emailService.js
â”‚   â”œâ”€â”€ pdfService.js
â”‚   â””â”€â”€ paymentService.js
â”‚
â”œâ”€â”€ utils/              # Utility functions
â”‚   â”œâ”€â”€ seatLocking.js
â”‚   â”œâ”€â”€ pricing.js
â”‚   â””â”€â”€ tripReminderScheduler.js
â”‚
â””â”€â”€ microservices/      # Modular services
    â”œâ”€â”€ paymentService/
    â”œâ”€â”€ notificationService/
    â””â”€â”€ analyticsService/
```

**Key Backend Patterns:**

1. **Layered Architecture**
   ```
   Routes â†’ Controllers â†’ Services â†’ Models â†’ Database
   ```

2. **Middleware Chain**
   - Request validation
   - Authentication
   - Authorization
   - Error handling

3. **Dependency Injection**
   - Services injected into controllers
   - Models injected into services

## Data Flow

### 1. Booking Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    User      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Search Buses             â”‚
â”‚     GET /api/bus-schedules   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. Select Schedule          â”‚
â”‚     View seat availability   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. Lock Seats               â”‚
â”‚     POST /api/seats/lock     â”‚
â”‚     (15-minute hold)         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. Enter Passenger Details  â”‚
â”‚     Fill booking form        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. Create Booking           â”‚
â”‚     POST /api/bookings       â”‚
â”‚     Status: pending          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. Create Payment Session   â”‚
â”‚     POST /api/payments/createâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7. Process Payment          â”‚
â”‚     PayOS Gateway            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  8. Confirm Booking          â”‚
â”‚     POST /api/bookings/:id   â”‚
â”‚     /confirm                 â”‚
â”‚     Status: confirmed        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  9. Send Confirmation Email  â”‚
â”‚     + E-ticket PDF           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  10. Release Seat Lock       â”‚
â”‚      Confirm seats in DB     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Authentication Flow

**Local Authentication:**
```
Register â†’ Email Verification â†’ Login â†’ JWT Token â†’ Authenticated Requests
```

**OAuth Authentication (Google):**
```
Google Login â†’ OAuth Callback â†’ Create/Link Account â†’ JWT Token â†’ Authenticated
```

### 3. Real-time Seat Locking

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User A     â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Lock Seats 1,2  â”‚â”€â”€â”€â”€â–¶â”‚  Redis Cache     â”‚
â”‚  Session: ABC    â”‚     â”‚  SET seat:1:ABC  â”‚
â”‚  TTL: 15 min     â”‚     â”‚  EXPIRE 900      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚  PostgreSQL      â”‚
                         â”‚  seat_locks      â”‚
                         â”‚  status: locked  â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User B     â”‚  (tries same seats)
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Lock Seats 1,2  â”‚â”€â”€â”€â”€â–¶â”‚  Redis Cache     â”‚
â”‚  Session: XYZ    â”‚     â”‚  GET seat:1      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  EXISTS â†’ REJECT â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚  Return Error    â”‚
                         â”‚  Seats locked    â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Security Architecture

### 1. Authentication & Authorization

**JWT-Based Authentication:**
```javascript
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "payload": {
    "id": 1,
    "email": "user@example.com",
    "position": "customer",
    "iat": 1640000000,
    "exp": 1640604800  // 7 days
  }
}
```

**Authorization Levels:**
- **Public** - No authentication required
- **Authenticated** - Valid JWT token required
- **Admin** - Admin role required

**Middleware Chain:**
```
Request â†’ CORS â†’ Authentication â†’ Authorization â†’ Controller
```

### 2. Password Security

- **Hashing**: bcrypt with salt rounds (10)
- **Validation**: Minimum 8 characters
- **Reset**: Time-limited tokens (1 hour expiry)
- **Verification**: Email-based verification

### 3. Data Protection

**Encryption:**
- Passwords: bcrypt hashing
- JWT: HMAC SHA256 signing
- HTTPS: SSL/TLS in production

**Input Validation:**
- Server-side validation
- SQL injection prevention (ORM)
- XSS protection (sanitization)

**Session Security:**
- Secure cookies (httpOnly, secure)
- CSRF protection (potential)
- Session expiration

### 4. API Security

**Rate Limiting** (ready for implementation):
```javascript
{
  windowMs: 15 * 60 * 1000,  // 15 minutes
  max: 100                    // 100 requests per window
}
```

**CORS Configuration:**
```javascript
{
  origin: process.env.CLIENT_URL,
  credentials: true
}
```

## Scalability Design

### 1. Horizontal Scaling

**Stateless Architecture:**
- JWT tokens (no server-side session state)
- Redis for session storage
- Load balancer ready

**Database Scaling:**
- Read replicas for queries
- Write master for updates
- Connection pooling

### 2. Caching Strategy

**Redis Caching Layers:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Application Layer                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  L1 Cache (Redis)                   â”‚
â”‚  - Seat availability                â”‚
â”‚  - Bus schedules (15 min TTL)       â”‚
â”‚  - Route data (1 hour TTL)          â”‚
â”‚  - User sessions                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼ (Cache Miss)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database (PostgreSQL)              â”‚
â”‚  - Source of truth                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Cache Invalidation:**
- Time-based expiration (TTL)
- Event-based invalidation
- Manual flush for critical updates

### 3. Database Optimization

**Indexing Strategy:**
- Primary keys (auto-indexed)
- Foreign keys (indexed)
- Search fields (composite indexes)
- Date fields (range queries)

**Query Optimization:**
- Eager loading (avoid N+1)
- Pagination (LIMIT/OFFSET)
- Select specific fields
- Avoid full table scans

### 4. Microservices Ready

**Service Decomposition:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Gateway      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼           â–¼          â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Booking â”‚ â”‚Payment  â”‚ â”‚Email  â”‚ â”‚Analytics â”‚
â”‚Service â”‚ â”‚Service  â”‚ â”‚Serviceâ”‚ â”‚Service   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Deployment Architecture

### Development Environment

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Developer Machine                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Frontend  â”‚  â”‚    Backend     â”‚ â”‚
â”‚  â”‚ Port: 5173 â”‚  â”‚  Port: 4000    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ PostgreSQL â”‚  â”‚     Redis      â”‚ â”‚
â”‚  â”‚ Port: 5432 â”‚  â”‚  Port: 6379    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Production Environment (Suggested)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Load Balancer (Nginx)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼                 â–¼            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ App     â”‚      â”‚ App     â”‚  â”‚ App     â”‚
â”‚ Server 1â”‚      â”‚ Server 2â”‚  â”‚ Server 3â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                 â”‚            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Database Cluster                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Master  â”‚â”€â”€â”€â–¶â”‚  Read Replicaâ”‚  â”‚
â”‚  â”‚  (Write) â”‚    â”‚   (Read)     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Redis Cluster                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Master  â”‚â”€â”€â”€â–¶â”‚   Replica    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Container Deployment (Docker)

```yaml
# docker-compose.yml example
services:
  frontend:
    build: ./bus-booking-client
    ports:
      - "80:80"
  
  backend:
    build: ./bus-booking-server
    ports:
      - "4000:4000"
    depends_on:
      - postgres
      - redis
  
  postgres:
    image: postgres:15
    volumes:
      - pgdata:/var/lib/postgresql/data
  
  redis:
    image: redis:7-alpine
```

## Performance Optimization

### 1. Frontend Optimization

**Code Splitting:**
```javascript
const AdminDashboard = lazy(() => import('./pages/AdminDashboard'));
```

**Asset Optimization:**
- Image lazy loading
- Code minification
- Tree shaking
- Gzip compression

### 2. Backend Optimization

**Database:**
- Connection pooling
- Query result caching
- Prepared statements
- Batch operations

**API Response:**
- Pagination
- Field selection
- Compression (gzip)
- ETags for caching

### 3. Network Optimization

- CDN for static assets
- HTTP/2 support
- Resource hints (preload, prefetch)
- Service workers (PWA)

## Monitoring and Logging

### Application Monitoring

**Metrics to Track:**
- API response times
- Error rates
- Request throughput
- Database query performance
- Cache hit/miss rates

**Tools (Suggested):**
- PM2 for process management
- Winston for logging
- Prometheus for metrics
- Grafana for visualization

### Error Handling

```javascript
// Centralized error handling
app.use((err, req, res, next) => {
  console.error(err.stack);
  res.status(err.status || 500).json({
    msg: err.message || "Server Error"
  });
});
```

### Logging Strategy

**Log Levels:**
- ERROR - Critical errors
- WARN - Warning conditions
- INFO - Informational messages
- DEBUG - Debug information (dev only)

**Log Format:**
```json
{
  "timestamp": "2024-12-20T10:30:00Z",
  "level": "ERROR",
  "message": "Database connection failed",
  "context": {
    "userId": 123,
    "endpoint": "/api/bookings"
  }
}
```

## Future Enhancements

### Planned Improvements

1. **GraphQL API** - More efficient data fetching
2. **WebSocket** - Real-time updates
3. **Service Mesh** - Istio/Linkerd for microservices
4. **Kubernetes** - Container orchestration
5. **CI/CD Pipeline** - Automated deployment
6. **Mobile Apps** - React Native
7. **Advanced Analytics** - Machine learning for demand prediction
8. **Multi-language Support** - i18n implementation

---

**Last Updated:** January 2, 2026
